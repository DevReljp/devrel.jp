---
layout: post
title:  オンラインミートアップの配信にPaperspaceを試す
date:   2020-05-22 00:00:00
catch: paperspace-5.png
categories:
- オンライン
- 配信
- ブログ
author: moongift
---

オンラインでミートアップイベントを行う機会が増えています。配信側として色々な知見をためている人も多いのではないでしょうか。配信手段としてはいくつかのやり方があるかと思います。

1. Zoomなど（Google MeetやSkypeでも可）などに全員が接続
2. Zoomなどの映像をOBSを使って配信する

![](/images/articles/paperspace-6.png)

前者は手軽なのが利点です。ただ、難点としてはイベント中はZoomなどの映像に集中してしまうので、ツイート数が増えないということがあります。コミュニティなので、なるべく拡散して欲しいと思っているので、この点は辛いです。また、ZoomはProプランくらいでは100人までという制限があります。他の動画チャットサービスでも人数上の制限があるので、この制限を超えて参加者が集まる場合には1は選択しづらいでしょう。

![](/images/articles/paperspace-7.png)

後者の仕組みの場合、OBSからYouTube Liveであったり、Twitchなどで配信ができます。こうすることで、人数の問題を超えて配信できたり、OBS上にツイートなどの追加情報を出すこともできます。オンラインミートアップの場合、参加人数が多くなる傾向があるので、個人的にはこの方法をとることが増えています。

とはいえ、問題もあります。まず一つがZoom、OBSなどを組み合わせて使う場合、配信側のPC負荷が大きいということです。特にOBSは負荷が大きく、ある程度のマシンでないとコマ落ちしたりします。他の作業もCPU負荷を考えると避けたいので、自ずと配信マシンは専用になってしまいます。

もう一つはネットワークです。OBSで配信する場合、アップロードで3Mbps程度あればいいようなのですが、昨今の自宅勤務の影響からか、夕方以降のネットワーク負荷が高くなっています。特にマンションなどで共同回線の場合、その影響が強く出ます。個人的には、ケーブルTVのインターネット回線ということもあって影響はなさそうだったのですが、先日のミートアップでは時々1Mbps程度まで落ちて戦々恐々としていました。

## そこでクラウド

そこで活用していきたいのがクラウドのデスクトップ環境になります。ZoomとOBSであればLinuxでも動くのですが、安定性や音声、GPUとの相性なども考えるとWindowsのデスクトップを利用するのがお勧めです。

[OBS Studio on Azure フルリモートで快適なオンライン配信環境を実現する - Qiita](https:/\/qiita.com/suzukin/items/f557434d8ddeeddf6ec6)の記事がかなり参考になるのですが、現在Azureでは需要が増えているようで、特にGPU系のインスタンスが選べなくなっています。

[Microsoft Azureの需要が775％増、「優先度基準」の適用が始まる--新型コロナで - ZDNet Japan](https://japan.zdnet.com/article/35151576/)

ということで、Paperspaceというクラウドデスクトップサービスを使ってみました。

![](/images/articles/paperspace-1.png)

[Paperspace: Cloud Machine Learning, AI, and effortless GPU infrastructure.](https://www.paperspace.com/)

Paperspaceでの料金は次のようになっています。いくつかの種類がありますが、使えそうなのはこの二つです。この他、ストレージ（最低50GB、月 $5）がかかります。

- Pro : 8CPU / メモリ 32GB / GRID K180Q(4GB) - $0.31/時間
- GPU+ : 8CPU / メモリ 30GB / Quadro M4000 - $0.51/時間

ちなみにProを試してみたところ、OBSでの配信時にハードウェアベースのGPUが使えませんでした。なのでGPU+以上がお勧めです。また、GPU+は初期はロックされています。利用申請が必要で、OBSを使ってライブ配信したいとメッセージを送ったところ、ものの1〜2分でロック解除してくれました。GPU+であれば、OBSの配信時にハードウェアエンコードが指定できます。

## 操作はWebブラウザから

Windows Azureの場合、操作はRDPを使って行いますが、Paperspaceの場合はWebブラウザから行います。なお、VMが立ち上がるまでしばらく（5〜10分くらい）かかりました。Webブラウザだからだと思うのですが、特定のキーバインドが使えないのがちょっと辛いです（Alt-Tabなど）。

使い終わった後に案内のメールが来たのですが、専用アプリもあります。こちらを使えばキーバインドは自由に使えます。

[Paperspace App: Dedicated app for Windows, OS X, and Linux](https://www.paperspace.com/app)

後はGoogle Remote Desktopをインストールする方法が紹介されていましたが、これでもAlt-Tabなどは使えないように思います。Public IP割り当て機能もあるので、それを使えばRDPが使えるようになるかも知れません。

![](/images/articles/paperspace-2.png)

ちなみに専用アプリでは、ログイン時にGoogle/GitHubなどのサードパーティ認証を使っていた場合、ログインできません。しかたがないのでパスワードリセットをして、ID/パスワードログインできるようにしました。

## マルチモニター

変わったところで、マルチモニター機能があります。Windowsからどう認識されているのか分かりませんが、メインディスプレイにあるウィンドウを別なウィンドウに移動させられます。これはクラウド系のデスクトップとしてはかなり便利です。例えばZoomを最大表示しておけば、OBS側での配置調整が簡単になります。

![](/images/articles/paperspace-5.png)

## 音声は調整が必要

OBSで試してみたところ、かなりノイズを拾っていました。これはWindows側の問題なのか、Paperspaceなのかは分かっていません。とりあえずOBSで調整すればノイズ除去できます。

## ネットワーク速度は快適

問題のネットワーク速度ですが、上下ともに数百Mbps出ていますので、OBSでのストリーミング配信もまったく気になりません。これはかなり嬉しいです。低遅延くらいであれば問題ないでしょう。

## Zoomが真っ黒になる問題

Zoomで画面共有をした際に、表示ができない問題がありました。これは二つの解決法があります。

- Google Chromeで表示する
- 古いバージョンのZoomクライアントを使う

前者の場合、デフォルトのままだとGoogle Chromeも表示が真っ黒です。そこで、ハードウェアアクセラレーションをオフにします。そうすると表示されるはずですが、CPUベースでの描画になっているはずなのでお勧めできません。そもそもこの問題はZoomクライアント側にあるようなので、古いバージョン4.4系をインストールするのが手っ取り早いです。セキュリティ的な問題もあるのですが、クラウドデスクトップというのは、この点でも安心かも知れません（少なくとも自分の環境に被害はこないので）。

### 追記（2020/07/04）

Zoom 5.0では、ビデオ設定の中にある、レンダリングエンジンを選択することで解決できます。

## 必要ない時は落としておく

クラウドデスクトップなので、立ち上げていると課金されていきます。イベントの時以外は落としておきましょう。勉強会の3時間くらいであれば、$1.53（≒ 164円）で運用できます。なお、Paperspaceでは一定時間操作をしないとシャットダウンしてくれる機能があります。1時間とかに設定しておくとよさそうです。

## まとめ

まだ実戦投入は行っていないのですが、試してみた限りでは悪くなさそうです。何より、手元のネットワーク環境が悪化した時のリスクを考えると、早めにクラウド化した方がいいでしょう。

追記）紹介コードが手に入ったので、もし試してみる場合はこちらのプロモコードを入力してみてください （JM7S5VG）。10ドルくらい無料で使えるようです。時間にして7時間分くらい。

[Paperspace: Cloud Machine Learning, AI, and effortless GPU infrastructure.](https://www.paperspace.com/)
